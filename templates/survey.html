<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Email Survey</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script>
    // Track viewing time
    let startTime = new Date().getTime();
    function submitForm() {
      let endTime = new Date().getTime();
      let viewTime = endTime - startTime;
      document.getElementById('view_time').value = viewTime;
      return true;
    }

    // Function to select an email when clicked
    function selectEmail(side) {
      document.querySelector(`input[name="selected_email"][value="${side}"]`).checked = true;

      document.querySelectorAll('.email-column').forEach(column => {
        column.classList.remove('selected-email');
      });
      document.querySelectorAll('.radio-option').forEach(opt => {
        opt.classList.remove('selected');
      });

      const selectedColumn = document.querySelector(`.email-column[data-side="${side}"]`);
      if (selectedColumn) {
        selectedColumn.classList.add('selected-email');

        if (!selectedColumn.querySelector('.selection-indicator')) {
          const indicator = document.createElement('div');
          indicator.className = 'selection-indicator';
          indicator.innerHTML = 'âœ“ SELECTED';
          selectedColumn.querySelector('.email-header').appendChild(indicator);
        }

        document.querySelectorAll(`.email-column:not([data-side="${side}"]) .selection-indicator`).forEach(el => {
          el.remove();
        });
      }

      document.querySelector(`.radio-option input[value="${side}"]`).parentNode.classList.add('selected');

      const questionHeading = document.querySelector('.selection-area h3');
      setTimeout(() => {
        const windowHeight = window.innerHeight;
        const headingRect = questionHeading.getBoundingClientRect();
        const targetPosition = window.pageYOffset + headingRect.top - (windowHeight * 0.3);

        window.scrollTo({
          top: targetPosition,
          behavior: 'smooth'
        });
      }, 100);
    }
  </script>
  <style>
    .container {
      display: flex;
    }
    .main-content {
      flex: 3;
    }
    .task-box {
      background-color: #f1f9fe;
      border-left: 4px solid #3498db;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
      font-size: 16px;
    }
    .task-box h2 {
      margin-top: 0;
      color: #2c3e50;
    }
    .email-column {
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid #ddd;
      border-radius: 5px;
      position: relative;
      margin-bottom: 15px;
    }
    .email-column:hover {
      background-color: #f5f5f5;
      border-color: #aaa;
    }
    .selected-email {
      border-color: #2563eb;
      background-color: #eff6ff;
      box-shadow: 0 0 15px rgba(37, 99, 235, 0.5);
      transform: translateY(-3px);
    }
    .email-header {
      position: relative;
      background-color: #f1f5f9;
      padding: 10px 15px;
      border-bottom: 1px solid #ddd;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .selected-email .email-header {
      background-color: #2563eb;
      color: white;
    }
    .selection-indicator {
      background-color: #10b981;
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
      margin-left: 10px;
      display: inline-block;
    }
    .radio-group {
      display: flex;
      gap: 20px;
      margin: 20px 0;
    }
    .radio-option {
      padding: 12px 20px;
      border: 3px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      background-color: #f9fafb;
    }
    .radio-option:hover {
      border-color: #bbb;
      background-color: #f1f5f9;
    }
    .radio-option.selected {
      border-color: #2563eb;
      background-color: #eff6ff;
      box-shadow: 0 0 10px rgba(37, 99, 235, 0.3);
    }
    .radio-option input {
      margin-right: 10px;
    }
    .selection-area {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }
    .selection-area h3 {
      color: #1e40af;
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 2px solid #e5e7eb;
    }
    button[type="submit"] {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s;
      margin-top: 15px;
    }
    button[type="submit"]:hover {
      background-color: #1d4ed8;
    }
    textarea {
      width: 100%;
      min-height: 100px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: inherit;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <header>
    <h1><a href="{{ url_for('instructions') }}" style="text-decoration: none; color: inherit;">Email Trustworthiness Survey</a></h1>
  </header>
  <div class="container">
    <div class="main-content">
      <div class="task-box">
  <h2>Task Overview</h2>
  <p><strong style="color: red;">You are John Doe</strong>, a Senior Benefits Coordinator at Core KG. Your character card is visible below for reference.</p>
  <p>Use the <strong>search box</strong> to quickly find information about <strong style="color: red;">known friends by name</strong>, or search for a <strong style="color: red;">project</strong> or <strong style="color: red;">familiar company</strong> to assist in your evaluation.</p>
  <p><strong style="color: blue; font-size: 18px;">Your task: Select the more trustworthy email</strong></p>
</div>

      <div class="progress">
        <span>Progress:</span>
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ (pair_number / total_pairs) * 100 }}%"></div>
        </div>
        <span>{{ pair_number }} of {{ total_pairs }}</span>
      </div>

      <div class="email-pair">
        <div class="email-column" data-side="left" onclick="selectEmail('left')">
          <div class="email-header">Email 1</div>
          <div class="email-content">
            {{ email_left|safe }}
          </div>
        </div>
        <div class="email-column" data-side="right" onclick="selectEmail('right')">
          <div class="email-header">Email 2</div>
          <div class="email-content">
            {{ email_right|safe }}
          </div>
        </div>
      </div>

      <div class="selection-area">
        <form action="{{ url_for('survey') }}" method="post" onsubmit="return submitForm()">
          <input type="hidden" name="pair_number" value="{{ pair_number }}">
          <input type="hidden" name="email_left" value="{{ file_left }}">
          <input type="hidden" name="email_right" value="{{ file_right }}">
          <input type="hidden" name="view_time" id="view_time" value="">

          <h3>Which email appears more trustworthy?</h3>
          <div class="radio-group">
            <label class="radio-option">
              <input type="radio" name="selected_email" value="left" required>
              <span>Email 1</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="selected_email" value="right" required>
              <span>Email 2</span>
            </label>
          </div>

          <h3>Please explain your reasoning (optional):</h3>
          <textarea name="explanation"></textarea>

          <button type="submit">Continue</button>
        </form>
      </div>
    </div>
  </div>
</body>
</html>